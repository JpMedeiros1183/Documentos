<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gerador de Documentos Jur√≠dicos</title>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
        }

        h1 {
            text-align: center;
            color: #1e3a5f;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 3px solid #1e3a5f;
        }

        .doc-selection {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 25px;
        }

        .doc-selection h2 {
            color: #1e3a5f;
            margin-bottom: 20px;
            font-size: 1.2rem;
        }

        .doc-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .doc-option {
            display: flex;
            align-items: center;
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

        .doc-option:hover {
            border-color: #2c5282;
            background: #f7fafc;
        }

        .doc-option.selected {
            border-color: #1e3a5f;
            background: #e6f0ff;
        }

        .doc-option input[type="checkbox"] {
            width: 24px;
            height: 24px;
            margin-right: 15px;
            cursor: pointer;
            accent-color: #1e3a5f;
            pointer-events: none;
        }

        .doc-option label {
            cursor: pointer;
            font-weight: 600;
            flex: 1;
            pointer-events: none;
        }

        .doc-option small {
            color: #666;
            font-weight: normal;
            display: block;
            margin-top: 4px;
        }

        .form-container {
            background: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            display: none;
        }

        .form-container.active {
            display: block;
        }

        .section-title {
            margin-top: 25px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #1e3a5f;
            color: #1e3a5f;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -10px;
        }

        .form-col {
            flex: 1 0 250px;
            padding: 0 10px;
            margin-bottom: 15px;
        }

        .form-col-small {
            flex: 0 0 120px;
            padding: 0 10px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 600;
            margin-bottom: 5px;
            font-size: 0.9rem;
            color: #444;
        }

        .required::after {
            content: " *";
            color: #e53e3e;
        }

        input, select, textarea {
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.95rem;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #2c5282;
        }

        .representacao-box {
            background: #fffaf0;
            border: 2px solid #ed8936;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .representacao-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .representacao-header input {
            width: 20px;
            height: 20px;
            margin-right: 10px;
            cursor: pointer;
        }

        .representacao-header label {
            color: #c05621;
            margin: 0;
            cursor: pointer;
            font-weight: 600;
        }

        .representacao-fields {
            display: none;
            padding-top: 15px;
            border-top: 1px dashed #ed8936;
        }

        .representacao-fields.active {
            display: block;
        }

        .tipo-rep-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }

        .tipo-rep-option {
            flex: 1;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .tipo-rep-option:hover {
            border-color: #ed8936;
            background: #fffaf0;
        }

        .tipo-rep-option.active {
            border-color: #ed8936;
            background: #fffaf0;
            color: #c05621;
            font-weight: 600;
        }

        .tipo-rep-option input {
            display: none;
        }

        .doc-specific-fields {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
            border-left: 4px solid #1e3a5f;
        }

        .doc-specific-fields.active {
            display: block;
        }

        .doc-specific-title {
            color: #1e3a5f;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .pagamento-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 20px;
        }

        .pagamento-option {
            display: flex;
            align-items: center;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .pagamento-option:hover {
            border-color: #2c5282;
            background: #f7fafc;
        }

        .pagamento-option.selected {
            border-color: #1e3a5f;
            background: #e6f0ff;
        }

        .pagamento-option input[type="radio"] {
            width: 20px;
            height: 20px;
            margin-right: 12px;
            cursor: pointer;
            accent-color: #1e3a5f;
        }

        .pagamento-option label {
            cursor: pointer;
            margin: 0;
            font-weight: 600;
        }

        .pagamento-option small {
            display: block;
            color: #666;
            font-weight: normal;
            margin-top: 4px;
        }

        .pagamento-detalhes {
            display: none;
            margin-top: 15px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            border: 1px solid #e0e0e0;
        }

        .pagamento-detalhes.active {
            display: block;
        }

        .buttons {
            margin-top: 30px;
            text-align: center;
            display: flex;
            gap: 10px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 25px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #1e3a5f;
            color: white;
        }

        .btn-primary:hover {
            background: #2c5282;
        }

        .btn-secondary {
            background: #718096;
            color: white;
        }

        .btn-secondary:hover {
            background: #4a5568;
        }

        .preview-section {
            display: none;
            margin-top: 30px;
        }

        .preview-section.active {
            display: block;
        }

        #assinaturaModal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        #assinaturaModal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 8px;
            width: 100%;
            max-width: 800px;
            max-height: 90vh;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #e0e0e0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-body {
            flex: 1;
            padding: 20px;
        }

        .signature-pad-container {
            border: 2px dashed #ddd;
            border-radius: 4px;
            height: 300px;
            background: #f5f5f5;
        }

        #signature-canvas {
            width: 100%;
            height: 100%;
            cursor: crosshair;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid #e0e0e0;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1100;
        }

        .toast {
            background: white;
            padding: 15px 20px;
            border-radius: 4px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            margin-bottom: 10px;
            border-left: 4px solid;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .toast.success { border-left-color: #38a169; }
        .toast.error { border-left-color: #e53e3e; }
        .toast.warning { border-left-color: #ed8936; }

        @media (max-width: 768px) {
            .form-row {
                flex-direction: column;
            }
            
            .form-col, .form-col-small {
                flex: 1 0 100%;
            }
            
            .tipo-rep-selector {
                flex-direction: column;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
        }

        .hidden { display: none !important; }
        
        .debug-console {
            position: fixed;
            bottom: 10px;
            left: 10px;
            right: 10px;
            max-height: 150px;
            background: rgba(0,0,0,0.9);
            color: #0f0;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 11px;
            overflow-y: auto;
            z-index: 9999;
            display: none;
            opacity: 1;
            transition: opacity 0.5s ease;
        }
        
        .debug-console.fade-out {
            opacity: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>‚öñÔ∏è Gerador de Documentos Jur√≠dicos</h1>

        <div class="doc-selection" id="selecao-docs">
            <h2>Selecione os documentos que deseja gerar:</h2>
            <div class="doc-options">
                <div class="doc-option" onclick="toggleSelection('procuracao')" id="opt-procuracao">
                    <input type="checkbox" id="check-procuracao">
                    <label>
                        Procura√ß√£o "Ad Judicia et Extra"
                        <small>Instrumento de mandato para representa√ß√£o judicial e extrajudicial</small>
                    </label>
                </div>
                <div class="doc-option" onclick="toggleSelection('hipossuficiencia')" id="opt-hipossuficiencia">
                    <input type="checkbox" id="check-hipossuficiencia">
                    <label>
                        Declara√ß√£o de Hipossufici√™ncia
                        <small>Para fins de gratuidade de justi√ßa (Art. 99, CPC)</small>
                    </label>
                </div>
                <div class="doc-option" onclick="toggleSelection('contrato')" id="opt-contrato">
                    <input type="checkbox" id="check-contrato">
                    <label>
                        Contrato de Honor√°rios Advocat√≠cios
                        <small>Contrato de presta√ß√£o de servi√ßos advocat√≠cios</small>
                    </label>
                </div>
            </div>
        </div>

        <div class="form-container" id="formulario-principal">
            
            <div id="secao-representacao" class="hidden">
                <div class="representacao-box">
                    <div class="representacao-header">
                        <input type="checkbox" id="representa-terceiro" onchange="toggleRepresentacao()">
                        <label for="representa-terceiro">üõ°Ô∏è Estou representando um terceiro (n√£o sou o pr√≥prio interessado)</label>
                    </div>
                    
                    <div class="representacao-fields" id="campos-representacao">
                        
                        <div class="tipo-rep-selector">
                            <label class="tipo-rep-option active" onclick="setTipoRepresentacao('incapaz')" id="opt-incapaz">
                                <input type="radio" name="tipo-rep" value="incapaz" checked>
                                üë§ Incapaz (menor/interdito)<br>
                                <small>Tutor/Curador/Pai/M√£e</small>
                            </label>
                            <label class="tipo-rep-option" onclick="setTipoRepresentacao('empresa')" id="opt-empresa">
                                <input type="radio" name="tipo-rep" value="empresa">
                                üè¢ Pessoa Jur√≠dica (Empresa)<br>
                                <small>S√≥cio/Propriet√°rio/Representante</small>
                            </label>
                        </div>

                        <div id="rep-incapaz-fields">
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">Nome do Representante</label>
                                        <input type="text" id="rep-nome">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">CPF do Representante</label>
                                        <input type="text" id="rep-cpf" maxlength="14" placeholder="000.000.000-00">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">Qualifica√ß√£o</label>
                                        <select id="rep-qualificacao">
                                            <option value="">Selecione...</option>
                                            <option value="Tutor">Tutor</option>
                                            <option value="Curador">Curador</option>
                                            <option value="Pai">Pai</option>
                                            <option value="M√£e">M√£e</option>
                                            <option value="Respons√°vel Legal">Respons√°vel Legal</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div id="rep-empresa-fields" class="hidden">
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">Raz√£o Social da Empresa</label>
                                        <input type="text" id="emp-razao">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">CNPJ</label>
                                        <input type="text" id="emp-cnpj" maxlength="18" placeholder="00.000.000/0000-00">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">Nome do Representante (S√≥cio/Propriet√°rio)</label>
                                        <input type="text" id="emp-rep-nome">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">CPF do Representante</label>
                                        <input type="text" id="emp-rep-cpf" maxlength="14" placeholder="000.000.000-00">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">Cargo/Qualifica√ß√£o</label>
                                        <select id="emp-rep-cargo">
                                            <option value="">Selecione...</option>
                                            <option value="S√≥cio Administrador">S√≥cio Administrador</option>
                                            <option value="Propriet√°rio">Propriet√°rio</option>
                                            <option value="Diretor">Diretor</option>
                                            <option value="Gerente">Gerente</option>
                                            <option value="Representante Legal">Representante Legal</option>
                                            <option value="Administrador">Administrador</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="section-title" style="margin-top: 15px; font-size: 1rem;">Endere√ßo da Empresa</div>
                            <div class="form-row">
                                <div class="form-col-small">
                                    <div class="form-group">
                                        <label class="required">CEP</label>
                                        <input type="text" id="emp-cep" maxlength="9" placeholder="00000-000" onblur="buscarCEPEmpresa(this.value)">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">Logradouro</label>
                                        <input type="text" id="emp-logradouro">
                                    </div>
                                </div>
                                <div class="form-col-small">
                                    <div class="form-group">
                                        <label class="required">N√∫mero</label>
                                        <input type="text" id="emp-numero">
                                    </div>
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-col">
                                    <div class="form-group">
                                        <label>Complemento</label>
                                        <input type="text" id="emp-complemento" placeholder="Sala, Andar, etc.">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">Bairro</label>
                                        <input type="text" id="emp-bairro">
                                    </div>
                                </div>
                                <div class="form-col">
                                    <div class="form-group">
                                        <label class="required">Cidade</label>
                                        <input type="text" id="emp-cidade">
                                    </div>
                                </div>
                                <div class="form-col-small">
                                    <div class="form-group">
                                        <label class="required">UF</label>
                                        <select id="emp-uf">
                                            <option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option>
                                            <option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option>
                                            <option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option>
                                            <option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option>
                                            <option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option>
                                            <option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option>
                                            <option value="RJ">RJ</option><option value="RN" selected>RN</option>
                                            <option value="RS">RS</option><option value="RO">RO</option><option value="RR">RR</option>
                                            <option value="SC">SC</option><option value="SP">SP</option><option value="SE">SE</option>
                                            <option value="TO">TO</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <div class="section-title" id="titulo-dados-pessoais">Dados Pessoais do Outorgante</div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label class="required">Nome Completo</label>
                        <input type="text" id="nome" required>
                    </div>
                </div>
                <div class="form-col-small">
                    <div class="form-group">
                        <label class="required">Nacionalidade</label>
                        <input type="text" id="nacionalidade" value="Brasileiro(a)">
                    </div>
                </div>
                <div class="form-col-small">
                    <div class="form-group">
                        <label class="required">Estado Civil</label>
                        <select id="estado-civil">
                            <option value="Solteiro(a)">Solteiro(a)</option>
                            <option value="Casado(a)">Casado(a)</option>
                            <option value="Divorciado(a)">Divorciado(a)</option>
                            <option value="Vi√∫vo(a)">Vi√∫vo(a)</option>
                            <option value="Uni√£o Est√°vel">Uni√£o Est√°vel</option>
                            <option value="Menor de Idade">Menor de Idade</option>
                            <option value="Interdito(a)">Interdito(a)</option>
                        </select>
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label id="label-profissao" class="required">Profiss√£o</label>
                        <input type="text" id="profissao">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="required">RG</label>
                        <input type="text" id="rg" placeholder="00.000.000-0 SSP/RN">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="required">CPF</label>
                        <input type="text" id="cpf" maxlength="14" placeholder="000.000.000-00" required>
                    </div>
                </div>
            </div>

            <div class="section-title">Endere√ßo do Outorgante</div>
            <div class="form-row">
                <div class="form-col-small">
                    <div class="form-group">
                        <label class="required">CEP</label>
                        <input type="text" id="cep" maxlength="9" placeholder="00000-000" onblur="buscarCEP(this.value)">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="required">Logradouro</label>
                        <input type="text" id="logradouro">
                    </div>
                </div>
                <div class="form-col-small">
                    <div class="form-group">
                        <label class="required">N√∫mero</label>
                        <input type="text" id="numero">
                    </div>
                </div>
            </div>

            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label>Complemento</label>
                        <input type="text" id="complemento" placeholder="Apto, Bloco, Sala...">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="required">Bairro</label>
                        <input type="text" id="bairro">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label class="required">Cidade</label>
                        <input type="text" id="cidade">
                    </div>
                </div>
                <div class="form-col-small">
                    <div class="form-group">
                        <label class="required">UF</label>
                        <select id="uf">
                            <option value="AC">AC</option><option value="AL">AL</option><option value="AP">AP</option>
                            <option value="AM">AM</option><option value="BA">BA</option><option value="CE">CE</option>
                            <option value="DF">DF</option><option value="ES">ES</option><option value="GO">GO</option>
                            <option value="MA">MA</option><option value="MT">MT</option><option value="MS">MS</option>
                            <option value="MG">MG</option><option value="PA">PA</option><option value="PB">PB</option>
                            <option value="PR">PR</option><option value="PE">PE</option><option value="PI">PI</option>
                            <option value="RJ">RJ</option><option value="RN" selected>RN</option>
                            <option value="RS">RS</option><option value="RO">RO</option><option value="RR">RR</option>
                            <option value="SC">SC</option><option value="SP">SP</option><option value="SE">SE</option>
                            <option value="TO">TO</option>
                        </select>
                    </div>
                </div>
            </div>

            <div id="campos-hipossuficiencia" class="doc-specific-fields">
                <div class="doc-specific-title">üìã Dados Espec√≠ficos - Declara√ß√£o de Hipossufici√™ncia</div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="required">Renda Mensal Bruta (R$)</label>
                            <input type="text" id="hipo-renda" placeholder="0,00" oninput="formatarMoeda(this)">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>N√∫mero de Dependentes</label>
                            <input type="number" id="hipo-dependentes" min="0" value="0">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label>N√∫mero do Processo (se houver)</label>
                            <input type="text" id="hipo-processo" placeholder="0000000-00.0000.0.00.0000">
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="required">Descri√ß√£o da Situa√ß√£o Econ√¥mica</label>
                            <textarea id="hipo-descricao" rows="3" placeholder="Descreva por que n√£o pode arcar com custas e honor√°rios..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-col">
                        <label>Documentos Comprobat√≥rios:</label>
                        <div style="margin-top: 8px;">
                            <label style="display: inline-flex; align-items: center; margin-right: 15px; margin-bottom: 8px; font-weight: normal;">
                                <input type="checkbox" id="hipo-doc-cadunico" style="margin-right: 5px;"> Cad√önico
                            </label>
                            <label style="display: inline-flex; align-items: center; margin-right: 15px; margin-bottom: 8px; font-weight: normal;">
                                <input type="checkbox" id="hipo-doc-ctps" style="margin-right: 5px;"> CTPS/Holerite
                            </label>
                            <label style="display: inline-flex; align-items: center; margin-right: 15px; margin-bottom: 8px; font-weight: normal;">
                                <input type="checkbox" id="hipo-doc-bpc" style="margin-right: 5px;"> BPC/LOAS
                            </label>
                            <label style="display: inline-flex; align-items: center; margin-bottom: 8px; font-weight: normal;">
                                <input type="checkbox" id="hipo-doc-ir" style="margin-right: 5px;"> IR (Isento)
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            <div id="campos-contrato" class="doc-specific-fields">
                <div class="doc-specific-title">üìã Dados Espec√≠ficos - Contrato de Honor√°rios</div>
                
                <div class="form-row">
                    <div class="form-col">
                        <div class="form-group">
                            <label class="required">N√∫mero do Processo / Parte Adversa</label>
                            <input type="text" id="cont-processo" placeholder="Descreva o processo ou parte adversa">
                        </div>
                    </div>
                    <div class="form-col">
                        <div class="form-group">
                            <label>Vara/Comarca/Tribunal</label>
                            <input type="text" id="cont-vara" placeholder="Ex: 1¬™ Vara C√≠vel de Natal/RN">
                        </div>
                    </div>
                </div>

                <div class="section-title" style="font-size: 1rem; margin-top: 20px;">Forma de Pagamento</div>
                
                <div class="pagamento-options">
                    <div class="pagamento-option selected" onclick="selecionarPagamento('vista')" id="pag-vista">
                        <input type="radio" name="forma-pagamento" value="vista" checked onchange="atualizarCamposPagamento()">
                        <label>
                            üí∞ Pagamento √† Vista
                            <small>Valor √∫nico, sem parcelamento</small>
                        </label>
                    </div>
                    
                    <div class="pagamento-option" onclick="selecionarPagamento('vista-exito')" id="pag-vista-exito">
                        <input type="radio" name="forma-pagamento" value="vista-exito" onchange="atualizarCamposPagamento()">
                        <label>
                            üí∞üìà Pagamento √† Vista + √äxito
                            <small>Valor √∫nico + percentual sobre o proveito econ√¥mico final</small>
                        </label>
                    </div>
                    
                    <div class="pagamento-option" onclick="selecionarPagamento('parcelado')" id="pag-parcelado">
                        <input type="radio" name="forma-pagamento" value="parcelado" onchange="atualizarCamposPagamento()">
                        <label>
                            üí≥ Entrada + Parcelamento
                            <small>Entrada + saldo em at√© 10 parcelas mensais</small>
                        </label>
                    </div>
                    
                    <div class="pagamento-option" onclick="selecionarPagamento('parcelado-exito')" id="pag-parcelado-exito">
                        <input type="radio" name="forma-pagamento" value="parcelado-exito" onchange="atualizarCamposPagamento()">
                        <label>
                            üí≥üìà Entrada + Parcelamento + √äxito
                            <small>Entrada + parcelas + percentual sobre o proveito final</small>
                        </label>
                    </div>
                </div>

                <div id="detalhes-pagamento" class="pagamento-detalhes active">
                    
                    <div class="form-row">
                        <div class="form-col">
                            <div class="form-group">
                                <label class="required">Valor Total dos Honor√°rios (R$)</label>
                                <input type="text" id="cont-valor-total" placeholder="0,00" oninput="formatarMoeda(this)">
                            </div>
                        </div>
                    </div>

                    <div id="campo-exito" class="hidden">
                        <div class="form-row">
                            <div class="form-col-small">
                                <div class="form-group">
                                    <label class="required">Honor√°rios de √äxito (%)</label>
                                    <input type="number" id="cont-exito" min="0" max="100" step="0.1" placeholder="Ex: 20">
                                </div>
                            </div>
                            <div class="form-col">
                                <p style="margin-top: 25px; color: #666; font-size: 0.9rem;">
                                    Ser√° calculado sobre o proveito econ√¥mico final obtido no processo
                                </p>
                            </div>
                        </div>
                    </div>

                    <div id="campo-parcelamento" class="hidden">
                        <div class="form-row">
                            <div class="form-col">
                                <div class="form-group">
                                    <label>Valor da Entrada (R$)</label>
                                    <input type="text" id="cont-entrada" placeholder="0,00" oninput="formatarMoeda(this)" onblur="calcularParcelas()">
                                </div>
                            </div>
                            <div class="form-col-small">
                                <div class="form-group">
                                    <label class="required">N¬∫ Parcelas</label>
                                    <select id="cont-parcelas" onchange="calcularParcelas()">
                                        <option value="1">1x</option>
                                        <option value="2">2x</option>
                                        <option value="3">3x</option>
                                        <option value="4">4x</option>
                                        <option value="5">5x</option>
                                        <option value="6">6x</option>
                                        <option value="7">7x</option>
                                        <option value="8">8x</option>
                                        <option value="9">9x</option>
                                        <option value="10">10x</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-col-small">
                                <div class="form-group">
                                    <label class="required">Vencimento</label>
                                    <input type="number" id="cont-vencimento" min="1" max="31" value="5">
                                </div>
                            </div>
                            <div class="form-col" id="cont-display-parcela" style="display: none;">
                                <div class="form-group">
                                    <label>Valor da Parcela</label>
                                    <input type="text" id="cont-valor-parcela" readonly style="background: #e2e8f0;">
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <div class="section-title">Op√ß√µes de Assinatura</div>
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: normal;">
                            <input type="checkbox" id="usar-assinatura-digital" onchange="toggleAssinatura()">
                            <span>Usar assinatura digital (desenhar na tela)</span>
                        </label>
                    </div>
                </div>
            </div>

            <div id="preview-assinatura-container" class="hidden" style="margin-top: 15px; text-align: center;">
                <div style="border: 2px dashed #ddd; padding: 20px; border-radius: 4px; background: #f9f9f9;">
                    <canvas id="preview-canvas" style="max-width: 100%; height: 120px; background: white; border: 1px solid #ddd;"></canvas>
                    <br>
                    <button type="button" class="btn-secondary" onclick="abrirModalAssinatura()" style="margin-top: 10px;">
                        ‚úçÔ∏è Desenhar Assinatura
                    </button>
                </div>
            </div>

            <div class="buttons">
                <button type="button" class="btn-secondary" onclick="voltarSelecao()">‚Üê Voltar √† Sele√ß√£o</button>
                <button type="button" class="btn-primary" onclick="gerarDocumentos()">
                    üìÑ Gerar e Baixar PDF(s)
                </button>
            </div>
        </div>

        <div class="preview-section" id="secao-resultado">
            <h2 style="color: #1e3a5f; margin-bottom: 20px;">‚úÖ Documentos Gerados!</h2>
            <p style="margin-bottom: 20px;">Os documentos foram gerados e o download iniciado automaticamente.</p>
            <div id="lista-downloads"></div>
            <div class="buttons" style="margin-top: 30px;">
                <button type="button" class="btn-primary" onclick="novoDocumento()">üîÑ Gerar Novos Documentos</button>
            </div>
        </div>
    </div>

    <div id="assinaturaModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Desenhe sua Assinatura</h3>
                <button onclick="fecharModalAssinatura()" class="btn-secondary" style="padding: 8px 15px;">‚úï</button>
            </div>
            <div class="modal-body">
                <div class="signature-pad-container">
                    <canvas id="signature-canvas"></canvas>
                </div>
            </div>
            <div class="modal-footer">
                <button onclick="limparAssinatura()" class="btn-secondary">Limpar</button>
                <button onclick="salvarAssinatura()" class="btn-primary">Confirmar Assinatura</button>
            </div>
        </div>
    </div>

    <div class="toast-container" id="toast-container"></div>
    
    <div class="debug-console" id="debug-console"></div>

    <script>
        let debugTimeout;
        function debug(msg) {
            console.log(msg);
            const debugConsole = document.getElementById('debug-console');
            if (debugConsole) {
                debugConsole.style.display = 'block';
                debugConsole.classList.remove('fade-out');
                debugConsole.innerHTML += msg + '<br>';
                debugConsole.scrollTop = debugConsole.scrollHeight;
                
                if (debugTimeout) {
                    clearTimeout(debugTimeout);
                }
                
                debugTimeout = setTimeout(() => {
                    debugConsole.classList.add('fade-out');
                    setTimeout(() => {
                        debugConsole.style.display = 'none';
                        debugConsole.classList.remove('fade-out');
                    }, 500);
                }, 2000);
            }
        }

        const state = {
            documentos: [],
            assinaturaPad: null,
            assinaturaData: null,
            auditData: null,
            tipoRepresentacao: 'incapaz',
            formaPagamento: 'vista',
            deviceFingerprint: null
        };

        document.addEventListener('DOMContentLoaded', () => {
            debug('Inicializando...');
            initSignaturePad();
            aplicarMascaras();
            coletarFingerprint();
            debug('Inicializa√ß√£o completa');
        });

        async function coletarFingerprint() {
            try {
                const fingerprint = {
                    userAgent: navigator.userAgent,
                    platform: navigator.platform,
                    language: navigator.language,
                    languages: navigator.languages,
                    cookieEnabled: navigator.cookieEnabled,
                    onLine: navigator.onLine,
                    hardwareConcurrency: navigator.hardwareConcurrency || 'N/A',
                    deviceMemory: navigator.deviceMemory || 'N/A',
                    maxTouchPoints: navigator.maxTouchPoints || 0,
                    screen: {
                        width: screen.width,
                        height: screen.height,
                        availWidth: screen.availWidth,
                        availHeight: screen.availHeight,
                        colorDepth: screen.colorDepth,
                        pixelRatio: window.devicePixelRatio
                    },
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    timezoneOffset: new Date().getTimezoneOffset(),
                    plugins: Array.from(navigator.plugins || []).map(p => p.name),
                    mimeTypes: Array.from(navigator.mimeTypes || []).map(m => m.type),
                    canvasFingerprint: await gerarCanvasFingerprint(),
                    webglFingerprint: gerarWebGLFingerprint(),
                    audioFingerprint: await gerarAudioFingerprint(),
                    battery: await coletarInfoBateria(),
                    connection: coletarInfoConexao(),
                    geolocation: null
                };
                state.deviceFingerprint = fingerprint;
                debug('Fingerprint coletado');
            } catch (error) {
                debug('Erro fingerprint: ' + error.message);
                state.deviceFingerprint = { error: 'Falha na coleta' };
            }
        }

        function gerarCanvasFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                canvas.width = 200;
                canvas.height = 50;
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillStyle = '#f60';
                ctx.fillRect(125, 1, 62, 20);
                ctx.fillStyle = '#069';
                ctx.fillText('Canvas Fingerprint', 2, 15);
                ctx.fillStyle = 'rgba(102, 204, 0, 0.7)';
                ctx.fillText('Canvas Fingerprint', 4, 17);
                const dataURL = canvas.toDataURL();
                let hash = 0;
                for (let i = 0; i < dataURL.length; i++) {
                    const char = dataURL.charCodeAt(i);
                    hash = ((hash << 5) - hash) + char;
                    hash = hash & hash;
                }
                return hash.toString(16);
            } catch (e) {
                return 'N/A';
            }
        }

        function gerarWebGLFingerprint() {
            try {
                const canvas = document.createElement('canvas');
                const gl = canvas.getContext('webgl') || canvas.getContext('experimental-webgl');
                if (!gl) return { error: 'WebGL n√£o suportado' };
                const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
                return {
                    vendor: gl.getParameter(gl.VENDOR),
                    renderer: gl.getParameter(gl.RENDERER),
                    unmaskedVendor: debugInfo ? gl.getParameter(debugInfo.UNMASKED_VENDOR_WEBGL) : 'N/A',
                    unmaskedRenderer: debugInfo ? gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL) : 'N/A'
                };
            } catch (e) {
                return { error: e.message };
            }
        }

        async function gerarAudioFingerprint() {
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                if (!AudioContext) return 'N/A';
                const context = new AudioContext();
                const oscillator = context.createOscillator();
                const analyser = context.createAnalyser();
                const gainNode = context.createGain();
                oscillator.type = 'triangle';
                oscillator.frequency.setValueAtTime(10000, context.currentTime);
                gainNode.gain.setValueAtTime(0, context.currentTime);
                oscillator.connect(analyser);
                analyser.connect(gainNode);
                gainNode.connect(context.destination);
                oscillator.start(0);
                const frequencyData = new Uint8Array(analyser.frequencyBinCount);
                analyser.getByteFrequencyData(frequencyData);
                oscillator.stop();
                context.close();
                let hash = 0;
                const str = Array.from(frequencyData.slice(0, 50)).join(',');
                for (let i = 0; i < str.length; i++) {
                    hash = ((hash << 5) - hash) + str.charCodeAt(i);
                    hash = hash & hash;
                }
                return hash.toString(16);
            } catch (e) {
                return 'N/A';
            }
        }

        async function coletarInfoBateria() {
            try {
                if ('getBattery' in navigator) {
                    const battery = await navigator.getBattery();
                    return {
                        charging: battery.charging,
                        level: battery.level
                    };
                }
                return 'N/A';
            } catch (e) {
                return 'N/A';
            }
        }

        function coletarInfoConexao() {
            try {
                const connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection;
                if (connection) {
                    return {
                        effectiveType: connection.effectiveType,
                        type: connection.type
                    };
                }
                return 'N/A';
            } catch (e) {
                return 'N/A';
            }
        }

        async function coletarGeolocalizacao() {
            return new Promise((resolve) => {
                if (!navigator.geolocation) {
                    resolve('N√£o suportado');
                    return;
                }
                navigator.geolocation.getCurrentPosition(
                    (position) => {
                        resolve({
                            latitude: position.coords.latitude,
                            longitude: position.coords.longitude,
                            accuracy: position.coords.accuracy
                        });
                    },
                    (error) => {
                        resolve('Permiss√£o negada: ' + error.message);
                    },
                    { enableHighAccuracy: true, timeout: 5000, maximumAge: 0 }
                );
            });
        }

        function toggleSelection(tipo) {
            const checkbox = document.getElementById(`check-${tipo}`);
            const option = document.getElementById(`opt-${tipo}`);
            checkbox.checked = !checkbox.checked;
            option.classList.toggle('selected', checkbox.checked);
            atualizarFormulario();
        }

        function atualizarFormulario() {
            const procuracao = document.getElementById('check-procuracao').checked;
            const hipossuficiencia = document.getElementById('check-hipossuficiencia').checked;
            const contrato = document.getElementById('check-contrato').checked;
            state.documentos = [];
            if (procuracao) state.documentos.push('procuracao');
            if (hipossuficiencia) state.documentos.push('hipossuficiencia');
            if (contrato) state.documentos.push('contrato');
            if (state.documentos.length === 0) {
                document.getElementById('formulario-principal').classList.remove('active');
                return;
            }
            document.getElementById('formulario-principal').classList.add('active');
            document.getElementById('secao-representacao').classList.toggle('hidden', !procuracao);
            document.getElementById('campos-hipossuficiencia').classList.toggle('active', hipossuficiencia);
            document.getElementById('campos-contrato').classList.toggle('active', contrato);
            atualizarTituloDados();
        }

        function toggleRepresentacao() {
            const ativo = document.getElementById('representa-terceiro').checked;
            document.getElementById('campos-representacao').classList.toggle('active', ativo);
            atualizarTituloDados();
        }

        function setTipoRepresentacao(tipo) {
            state.tipoRepresentacao = tipo;
            document.getElementById('opt-incapaz').classList.toggle('active', tipo === 'incapaz');
            document.getElementById('opt-empresa').classList.toggle('active', tipo === 'empresa');
            document.getElementById('rep-incapaz-fields').classList.toggle('hidden', tipo !== 'incapaz');
            document.getElementById('rep-empresa-fields').classList.toggle('hidden', tipo !== 'empresa');
            atualizarTituloDados();
        }

        function atualizarTituloDados() {
            const representa = document.getElementById('representa-terceiro')?.checked;
            const titulo = document.getElementById('titulo-dados-pessoais');
            const labelProf = document.getElementById('label-profissao');
            if (!representa) {
                titulo.textContent = 'Dados Pessoais do Outorgante';
                labelProf.textContent = 'Profiss√£o';
                labelProf.classList.add('required');
                return;
            }
            if (state.tipoRepresentacao === 'incapaz') {
                titulo.textContent = 'Dados do Incapaz (Interessado)';
                labelProf.textContent = 'Profiss√£o (se houver)';
                labelProf.classList.remove('required');
            } else {
                titulo.textContent = 'Dados do S√≥cio/Propriet√°rio Representante';
                labelProf.textContent = 'Profiss√£o/Cargo';
                labelProf.classList.add('required');
            }
        }

        function selecionarPagamento(forma) {
            state.formaPagamento = forma;
            document.querySelectorAll('.pagamento-option').forEach(el => el.classList.remove('selected'));
            document.getElementById(`pag-${forma}`).classList.add('selected');
            document.querySelector(`input[name="forma-pagamento"][value="${forma}"]`).checked = true;
            atualizarCamposPagamento();
        }

        function atualizarCamposPagamento() {
            const forma = document.querySelector('input[name="forma-pagamento"]:checked').value;
            const mostrarExito = forma === 'vista-exito' || forma === 'parcelado-exito';
            const mostrarParcelamento = forma === 'parcelado' || forma === 'parcelado-exito';
            document.getElementById('campo-exito').classList.toggle('hidden', !mostrarExito);
            document.getElementById('campo-parcelamento').classList.toggle('hidden', !mostrarParcelamento);
        }

        function aplicarMascaras() {
            ['cpf', 'rep-cpf', 'emp-rep-cpf'].forEach(id => {
                const el = document.getElementById(id);
                if (!el) return;
                el.addEventListener('input', (e) => {
                    let v = e.target.value.replace(/\D/g, '').substring(0, 11);
                    v = v.replace(/(\d{3})(\d)/, '$1.$2');
                    v = v.replace(/(\d{3})(\d)/, '$1.$2');
                    v = v.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = v;
                });
            });
            
            document.getElementById('emp-cnpj')?.addEventListener('input', (e) => {
                let v = e.target.value.replace(/\D/g, '').substring(0, 14);
                v = v.replace(/^(\d{2})(\d)/, '$1.$2');
                v = v.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
                v = v.replace(/\.(\d{3})(\d)/, '.$1/$2');
                v = v.replace(/(\d{4})(\d)/, '$1-$2');
                e.target.value = v;
            });
            
            ['cep', 'emp-cep'].forEach(id => {
                document.getElementById(id)?.addEventListener('input', (e) => {
                    let v = e.target.value.replace(/\D/g, '').substring(0, 8);
                    v = v.replace(/^(\d{5})(\d)/, '$1-$2');
                    e.target.value = v;
                });
            });
        }

        async function buscarCEP(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length !== 8) return;
            try {
                const res = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await res.json();
                if (!data.erro) {
                    document.getElementById('logradouro').value = data.logradouro;
                    document.getElementById('bairro').value = data.bairro;
                    document.getElementById('cidade').value = data.localidade;
                    document.getElementById('uf').value = data.uf;
                    document.getElementById('numero').focus();
                }
            } catch (e) {
                console.error('Erro CEP:', e);
            }
        }

        async function buscarCEPEmpresa(cep) {
            cep = cep.replace(/\D/g, '');
            if (cep.length !== 8) return;
            try {
                const res = await fetch(`https://viacep.com.br/ws/${cep}/json/`);
                const data = await res.json();
                if (!data.erro) {
                    document.getElementById('emp-logradouro').value = data.logradouro;
                    document.getElementById('emp-bairro').value = data.bairro;
                    document.getElementById('emp-cidade').value = data.localidade;
                    document.getElementById('emp-uf').value = data.uf;
                    document.getElementById('emp-numero').focus();
                }
            } catch (e) {
                console.error('Erro CEP:', e);
            }
        }

        function formatarMoeda(input) {
            let v = input.value.replace(/\D/g, '');
            if (!v) { input.value = ''; return; }
            v = (parseInt(v) / 100).toLocaleString('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            });
            input.value = v;
        }

        function calcularParcelas() {
            const total = parseFloat(document.getElementById('cont-valor-total')?.value?.replace(/[^\d,]/g, '').replace(',', '.') || 0);
            const entrada = parseFloat(document.getElementById('cont-entrada')?.value?.replace(/[^\d,]/g, '').replace(',', '.') || 0);
            const parcelas = parseInt(document.getElementById('cont-parcelas')?.value || 1);
            const display = document.getElementById('cont-display-parcela');
            const input = document.getElementById('cont-valor-parcela');
            if (total > 0) {
                const valor = (total - entrada) / parcelas;
                input.value = valor.toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
                display.style.display = 'block';
            } else {
                display.style.display = 'none';
            }
        }

        function initSignaturePad() {
            const canvas = document.getElementById('signature-canvas');
            if (!canvas) return;
            state.assinaturaPad = new SignaturePad(canvas, {
                backgroundColor: 'rgb(255, 255, 255)',
                penColor: 'rgb(0, 0, 0)'
            });
        }

        function toggleAssinatura() {
            const ativo = document.getElementById('usar-assinatura-digital').checked;
            document.getElementById('preview-assinatura-container').classList.toggle('hidden', !ativo);
        }

        function abrirModalAssinatura() {
            document.getElementById('assinaturaModal').classList.add('active');
            setTimeout(() => {
                const canvas = document.getElementById('signature-canvas');
                const container = canvas.parentElement;
                canvas.width = container.offsetWidth;
                canvas.height = container.offsetHeight;
                state.assinaturaPad.clear();
            }, 100);
        }

        function fecharModalAssinatura() {
            document.getElementById('assinaturaModal').classList.remove('active');
        }

        function limparAssinatura() {
            state.assinaturaPad.clear();
        }

        async function salvarAssinatura() {
            if (state.assinaturaPad.isEmpty()) {
                mostrarToast('Desenhe sua assinatura primeiro', 'warning');
                return;
            }
            state.assinaturaData = state.assinaturaPad.toDataURL('image/png');
            try {
                const ipRes = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipRes.json();
                const geolocation = await coletarGeolocalizacao();
                if (state.deviceFingerprint && typeof geolocation === 'object') {
                    state.deviceFingerprint.geolocation = geolocation;
                }
                state.auditData = {
                    timestamp: new Date().toISOString(),
                    ip: ipData.ip,
                    deviceFingerprint: state.deviceFingerprint
                };
            } catch (e) {
                state.auditData = { 
                    timestamp: new Date().toISOString(), 
                    ip: 'N/A',
                    deviceFingerprint: state.deviceFingerprint
                };
            }
            const preview = document.getElementById('preview-canvas');
            const ctx = preview.getContext('2d');
            const img = new Image();
            img.onload = () => {
                preview.width = img.width;
                preview.height = img.height;
                ctx.drawImage(img, 0, 0);
            };
            img.src = state.assinaturaData;
            fecharModalAssinatura();
            mostrarToast('Assinatura salva!', 'success');
        }

        function validarFormulario() {
            const representa = document.getElementById('representa-terceiro')?.checked;
            const camposObrigatorios = [
                'nome', 'nacionalidade', 'estado-civil', 'rg', 'cpf',
                'cep', 'logradouro', 'numero', 'bairro', 'cidade', 'uf'
            ];
            if (!representa || state.tipoRepresentacao !== 'incapaz') {
                camposObrigatorios.push('profissao');
            }
            if (representa && state.tipoRepresentacao === 'incapaz') {
                camposObrigatorios.push('rep-nome', 'rep-cpf', 'rep-qualificacao');
            }
            if (representa && state.tipoRepresentacao === 'empresa') {
                camposObrigatorios.push(
                    'emp-razao', 'emp-cnpj', 'emp-rep-nome', 'emp-rep-cpf', 'emp-rep-cargo',
                    'emp-cep', 'emp-logradouro', 'emp-numero', 'emp-bairro', 'emp-cidade', 'emp-uf'
                );
            }
            if (state.documentos.includes('hipossuficiencia')) {
                camposObrigatorios.push('hipo-renda', 'hipo-descricao');
            }
            if (state.documentos.includes('contrato')) {
                camposObrigatorios.push('cont-processo', 'cont-valor-total');
                const formaPagamento = document.querySelector('input[name="forma-pagamento"]:checked').value;
                if (formaPagamento === 'vista-exito' || formaPagamento === 'parcelado-exito') {
                    camposObrigatorios.push('cont-exito');
                }
            }
            let valido = true;
            camposObrigatorios.forEach(id => {
                const el = document.getElementById(id);
                if (!el || !el.value.trim()) {
                    if (el) el.style.borderColor = '#e53e3e';
                    valido = false;
                } else if (el) {
                    el.style.borderColor = '#ddd';
                }
            });
            if (!valido) mostrarToast('Preencha todos os campos obrigat√≥rios', 'error');
            return valido;
        }

        async function gerarDocumentos() {
            debug('Iniciando gera√ß√£o de documentos...');
            try {
                if (!validarFormulario()) {
                    debug('Valida√ß√£o falhou');
                    return;
                }
                
                debug('Formul√°rio v√°lido, coletando dados...');
                
                const representa = document.getElementById('representa-terceiro')?.checked || false;
                
                const dados = {
                    representa,
                    tipoRepresentacao: representa ? state.tipoRepresentacao : null,
                    representante: null,
                    empresa: null,
                    outorgante: {
                        nome: document.getElementById('nome').value,
                        nacionalidade: document.getElementById('nacionalidade').value,
                        estadoCivil: document.getElementById('estado-civil').value,
                        profissao: document.getElementById('profissao').value,
                        rg: document.getElementById('rg').value,
                        cpf: document.getElementById('cpf').value
                    },
                    endereco: {
                        cep: document.getElementById('cep').value,
                        logradouro: document.getElementById('logradouro').value,
                        numero: document.getElementById('numero').value,
                        complemento: document.getElementById('complemento').value,
                        bairro: document.getElementById('bairro').value,
                        cidade: document.getElementById('cidade').value,
                        uf: document.getElementById('uf').value
                    }
                };
                
                if (representa && state.tipoRepresentacao === 'incapaz') {
                    dados.representante = {
                        nome: document.getElementById('rep-nome').value,
                        cpf: document.getElementById('rep-cpf').value,
                        qualificacao: document.getElementById('rep-qualificacao').value
                    };
                }
                
                if (representa && state.tipoRepresentacao === 'empresa') {
                    dados.empresa = {
                        razao: document.getElementById('emp-razao').value,
                        cnpj: document.getElementById('emp-cnpj').value,
                        representante: {
                            nome: document.getElementById('emp-rep-nome').value,
                            cpf: document.getElementById('emp-rep-cpf').value,
                            cargo: document.getElementById('emp-rep-cargo').value
                        },
                        endereco: {
                            cep: document.getElementById('emp-cep').value,
                            logradouro: document.getElementById('emp-logradouro').value,
                            numero: document.getElementById('emp-numero').value,
                            complemento: document.getElementById('emp-complemento').value,
                            bairro: document.getElementById('emp-bairro').value,
                            cidade: document.getElementById('emp-cidade').value,
                            uf: document.getElementById('emp-uf').value
                        }
                    };
                }
                
                if (state.documentos.includes('hipossuficiencia')) {
                    const rendaEl = document.getElementById('hipo-renda');
                    const dependentesEl = document.getElementById('hipo-dependentes');
                    const descricaoEl = document.getElementById('hipo-descricao');
                    const processoEl = document.getElementById('hipo-processo');
                    
                    dados.hipossuficiencia = {
                        renda: rendaEl ? rendaEl.value : '',
                        dependentes: dependentesEl ? dependentesEl.value : '0',
                        descricao: descricaoEl ? descricaoEl.value : '',
                        processo: processoEl ? processoEl.value : '',
                        documentos: {
                            cadunico: document.getElementById('hipo-doc-cadunico')?.checked || false,
                            ctps: document.getElementById('hipo-doc-ctps')?.checked || false,
                            bpc: document.getElementById('hipo-doc-bpc')?.checked || false,
                            ir: document.getElementById('hipo-doc-ir')?.checked || false
                        }
                    };
                }
                
                if (state.documentos.includes('contrato')) {
                    const formaPagamento = document.querySelector('input[name="forma-pagamento"]:checked')?.value || 'vista';
                    dados.contrato = {
                        processo: document.getElementById('cont-processo')?.value || '',
                        vara: document.getElementById('cont-vara')?.value || '',
                        formaPagamento: formaPagamento,
                        valorTotal: document.getElementById('cont-valor-total')?.value || '',
                        entrada: document.getElementById('cont-entrada')?.value || 'R$ 0,00',
                        parcelas: document.getElementById('cont-parcelas')?.value || '1',
                        vencimento: document.getElementById('cont-vencimento')?.value || '5',
                        valorParcela: document.getElementById('cont-valor-parcela')?.value || '',
                        exito: document.getElementById('cont-exito')?.value || ''
                    };
                }
                
                const usarAssinatura = document.getElementById('usar-assinatura-digital')?.checked || false;
                
                debug(`Gerando ${state.documentos.length} documento(s)...`);
                
                for (const tipo of state.documentos) {
                    debug(`Gerando ${tipo}...`);
                    await gerarPDF(tipo, dados, usarAssinatura);
                    await new Promise(r => setTimeout(r, 500));
                }
                
                mostrarResultado();
                mostrarToast('Documentos gerados com sucesso!', 'success');
                debug('Conclu√≠do!');
                
            } catch (error) {
                debug('ERRO: ' + error.message);
                console.error(error);
                mostrarToast('Erro ao gerar documentos: ' + error.message, 'error');
            }
        }

        async function gerarPDF(tipo, dados, usarAssinatura) {
            debug(`Criando PDF para ${tipo}...`);
            
            try {
                const { jsPDF } = window.jspdf;
                if (!jsPDF) {
                    throw new Error('jsPDF n√£o carregado');
                }
                
                const pdf = new jsPDF('p', 'mm', 'a4');
                const html = gerarHTML(tipo, dados, usarAssinatura);
                
                debug('Criando elemento tempor√°rio...');
                const temp = document.createElement('div');
                temp.innerHTML = html;
                temp.style.cssText = 'position:absolute;left:-9999px;width:210mm;';
                document.body.appendChild(temp);
                
                debug('Renderizando com html2canvas...');
                const canvas = await html2canvas(temp, { 
                    scale: 2, 
                    useCORS: true,
                    logging: false
                });
                
                debug('Adicionando imagem ao PDF...');
                const imgData = canvas.toDataURL('image/png');
                const imgWidth = 210;
                const pageHeight = 297;
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                let heightLeft = imgHeight;
                let position = 0;
                
                pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                heightLeft -= pageHeight;
                
                while (heightLeft >= 0) {
                    position = heightLeft - imgHeight;
                    pdf.addPage();
                    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
                    heightLeft -= pageHeight;
                }
                
                const nome = dados.representa && dados.empresa 
                    ? dados.empresa.razao.replace(/\s+/g, '_')
                    : dados.outorgante.nome.replace(/\s+/g, '_');
                    
                const filename = `${tipo}_${nome}_${new Date().toISOString().split('T')[0]}.pdf`;
                debug(`Salvando: ${filename}`);
                pdf.save(filename);
                
                document.body.removeChild(temp);
                debug('PDF gerado com sucesso');
                
            } catch (error) {
                debug('ERRO no PDF: ' + error.message);
                throw error;
            }
        }

        function gerarHTML(tipo, dados, usarAssinatura) {
            const data = new Date().toLocaleDateString('pt-BR', {
                day: '2-digit', month: 'long', year: 'numeric'
            });
            
            let endereco, assinante, cpfAssinante, qualificacaoAssinante;
            
            if (dados.representa && dados.empresa) {
                endereco = `${dados.empresa.endereco.logradouro}, ${dados.empresa.endereco.numero}${dados.empresa.endereco.complemento ? ', ' + dados.empresa.endereco.complemento : ''}, ${dados.empresa.endereco.bairro}, ${dados.empresa.endereco.cidade}/${dados.empresa.endereco.uf}, CEP: ${dados.empresa.endereco.cep}`;
                assinante = dados.empresa.representante.nome;
                cpfAssinante = dados.empresa.representante.cpf;
                qualificacaoAssinante = dados.empresa.representante.cargo;
            } else {
                endereco = `${dados.endereco.logradouro}, ${dados.endereco.numero}${dados.endereco.complemento ? ', ' + dados.endereco.complemento : ''}, ${dados.endereco.bairro}, ${dados.endereco.cidade}/${dados.endereco.uf}, CEP: ${dados.endereco.cep}`;
                assinante = dados.representa ? dados.representante.nome : dados.outorgante.nome;
                cpfAssinante = dados.representa ? dados.representante.cpf : dados.outorgante.cpf;
                qualificacaoAssinante = dados.representa ? dados.representante.qualificacao : null;
            }

            function gerarInfoSeguranca() {
                if (!state.deviceFingerprint) return '';
                const fp = state.deviceFingerprint;
                const info = [];
                if (fp.platform) info.push(`Plataforma: ${fp.platform}`);
                if (fp.hardwareConcurrency) info.push(`CPU: ${fp.hardwareConcurrency} cores`);
                if (fp.canvasFingerprint && fp.canvasFingerprint !== 'N/A') {
                    info.push(`Canvas: ${fp.canvasFingerprint.substring(0, 8)}`);
                }
                return info.join(' | ');
            }

            // CORRE√á√ÉO PRINCIPAL: Auditoria SEMPRE aparece com texto vis√≠vel
            const auditoriaHTML = state.deviceFingerprint ? `
                <div style="margin-top:15px;padding:10px;border:1px solid #333;text-align:left;display:inline-block;max-width:90%;">
                    <p style="font-size:8pt;color:#000;margin:0;line-height:1.4;font-family:'Times New Roman',serif;">
                        <strong>AUDITORIA DO DOCUMENTO</strong><br>
                        Gerado em: ${new Date().toLocaleString('pt-BR')}<br>
                        ${gerarInfoSeguranca()}
                    </p>
                </div>` : '';

            const assinatura = usarAssinatura && state.assinaturaData
                ? `<div style="margin-top:30px;text-align:center;page-break-inside:avoid;">
                    <img src="${state.assinaturaData}" style="max-height:60px;border-bottom:1px solid #000;">
                    <p style="margin-top:5px;font-size:10pt;line-height:1.4;color:#000;">${assinante}<br>CPF: ${cpfAssinante}${qualificacaoAssinante ? '<br>' + qualificacaoAssinante : ''}</p>
                    ${state.auditData ? `
                    <div style="margin-top:10px;padding:10px;border:1px solid #333;text-align:left;display:inline-block;max-width:90%;">
                        <p style="font-size:8pt;color:#000;margin:0;line-height:1.4;font-family:'Times New Roman',serif;">
                            <strong>ASSINATURA DIGITAL</strong><br>
                            Assinado em: ${new Date(state.auditData.timestamp).toLocaleString('pt-BR')}<br>
                            IP: ${state.auditData.ip}<br>
                            ${gerarInfoSeguranca()}
                        </p>
                    </div>` : ''}
                    ${auditoriaHTML}
                   </div>`
                : `<div style="margin-top:40px;text-align:center;page-break-inside:avoid;">
                    <div style="width:60%;border-bottom:1px solid #000;margin:0 auto 5px;"></div>
                    <p style="font-size:10pt;line-height:1.4;color:#000;">${assinante}<br>CPF: ${cpfAssinante}${qualificacaoAssinante ? '<br>' + qualificacaoAssinante : ''}</p>
                    ${auditoriaHTML}
                   </div>`;

            const renda = dados.hipossuficiencia?.renda || 'N√£o informada';
            const dependentes = dados.hipossuficiencia?.dependentes || '0';
            const descricao = dados.hipossuficiencia?.descricao || '';
            const processoHipo = dados.hipossuficiencia?.processo || '';

            function gerarClausulaPagamento() {
                if (!dados.contrato) return '';
                
                const forma = dados.contrato.formaPagamento;
                const valorTotal = dados.contrato.valorTotal;
                const exito = dados.contrato.exito;
                const entrada = dados.contrato.entrada;
                const parcelas = dados.contrato.parcelas;
                const vencimento = dados.contrato.vencimento;
                const valorParcela = dados.contrato.valorParcela;
                
                let clausula = '';
                
                clausula += `<h4 style="text-align:center;margin:15px 0 8px;text-transform:uppercase;font-size:11pt;">Dos Honor√°rios</h4>`;
                
                if (forma === 'vista') {
                    clausula += `
                        <p style="text-align:justify;margin-bottom:8px;">
                            <strong>Cl√°usula 2¬™.</strong> Pelos servi√ßos contratados, o CONTRATANTE pagar√° ao CONTRATADO o valor de <strong>${valorTotal}</strong>, 
                            √† vista, no ato da assinatura deste contrato.
                        </p>`;
                } 
                else if (forma === 'vista-exito') {
                    clausula += `
                        <p style="text-align:justify;margin-bottom:8px;">
                            <strong>Cl√°usula 2¬™.</strong> Pelos servi√ßos contratados, o CONTRATANTE pagar√° ao CONTRATADO:
                        </p>
                        <p style="text-align:justify;margin-bottom:8px;padding-left:20px;">
                            a) O valor de <strong>${valorTotal}</strong>, √† vista, no ato da assinatura deste contrato;
                        </p>
                        <p style="text-align:justify;margin-bottom:8px;padding-left:20px;">
                            b) Honor√°rios de √™xito no percentual de <strong>${exito}%</strong> sobre o proveito econ√¥mico final obtido no processo, 
                            devidos apenas em caso de proced√™ncia do pedido ou acordo.
                        </p>`;
                }
                else if (forma === 'parcelado') {
                    const valorEntrada = entrada && entrada !== 'R$ 0,00' ? entrada : 'R$ 0,00';
                    const temEntrada = valorEntrada !== 'R$ 0,00';
                    
                    clausula += `
                        <p style="text-align:justify;margin-bottom:8px;">
                            <strong>Cl√°usula 2¬™.</strong> Pelos servi√ßos contratados, o CONTRATANTE pagar√° ao CONTRATADO o valor total de <strong>${valorTotal}</strong>, 
                            da seguinte forma:
                        </p>
                        <p style="text-align:justify;margin-bottom:8px;padding-left:20px;">
                            a) <strong>Entrada:</strong> ${temEntrada ? valorEntrada : 'N√£o h√° entrada'}, 
                            ${temEntrada ? 'no ato da assinatura deste contrato' : 'sendo o valor integral parcelado'};
                        </p>
                        <p style="text-align:justify;margin-bottom:8px;padding-left:20px;">
                            b) <strong>Parcelamento:</strong> O saldo remanescente ser√° pago em <strong>${parcelas}x</strong> parcelas mensais e consecutivas 
                            de <strong>${valorParcela || 'a calcular'}</strong>, vencendo-se a primeira no dia <strong>${vencimento}</strong> do m√™s seguinte √† assinatura, 
                            e as demais no mesmo dia dos meses subsequentes.
                        </p>
                        <p style="text-align:justify;margin-bottom:8px;padding-left:20px;">
                            c) <strong>Forma de pagamento:</strong> As parcelas ser√£o pagas mediante boleto banc√°rio ou transfer√™ncia banc√°ria para conta indicada pelo CONTRATADO.
                        </p>`;
                }
                else if (forma === 'parcelado-exito') {
                    const valorEntrada = entrada && entrada !== 'R$ 0,00' ? entrada : 'R$ 0,00';
                    const temEntrada = valorEntrada !== 'R$ 0,00';
                    
                    clausula += `
                        <p style="text-align:justify;margin-bottom:8px;">
                            <strong>Cl√°usula 2¬™.</strong> Pelos servi√ßos contratados, o CONTRATANTE pagar√° ao CONTRATADO:
                        </p>
                        <p style="text-align:justify;margin-bottom:8px;padding-left:20px;">
                            a) <strong>Honor√°rios contratuais:</strong> O valor de <strong>${valorTotal}</strong>, 
                            ${temEntrada ? `sendo <strong>${valorEntrada}</strong> de entrada no ato da assinatura,` : 'sendo o valor integral parcelado,'} 
                            e o saldo em <strong>${parcelas}x</strong> parcelas mensais de <strong>${valorParcela || 'a calcular'}</strong>, 
                            vencendo-se a primeira no dia <strong>${vencimento}</strong> do m√™s seguinte;
                        </p>
                        <p style="text-align:justify;margin-bottom:8px;padding-left:20px;">
                            b) <strong>Honor√°rios de √™xito:</strong> Percentual de <strong>${exito}%</strong> sobre o proveito econ√¥mico final obtido no processo, 
                            devidos apenas em caso de proced√™ncia do pedido ou acordo, calculados sobre o valor l√≠quido recebido pelo CONTRATANTE.
                        </p>`;
                }
                
                clausula += `
                    <p style="text-align:justify;margin-bottom:8px;">
                        <strong>Cl√°usula 2¬™-A.</strong> Em caso de atraso no pagamento de qualquer parcela, incidir√° multa de 2% (dois por cento) 
                        sobre o valor em atraso, al√©m de juros de 1% (um por cento) ao m√™s e corre√ß√£o monet√°ria pelo √≠ndice IGPM/FGV ou outro que venha a substitu√≠-lo.
                    </p>`;
                
                return clausula;
            }

            const templates = {
                procuracao: `
                    <div style="font-family:'Times New Roman',serif;font-size:11pt;line-height:1.5;padding:20mm 20mm;">
                        <div style="text-align:center;margin-bottom:15px;border-bottom:2px solid #1e3a5f;padding-bottom:10px;">
                            <h3 style="color:#1e3a5f;margin:0;">PROCURA√á√ÉO "AD JUDICIA ET EXTRA"</h3>
                            <p style="font-size:9pt;color:#666;margin:5px 0 0;">Medeiros e Albuquerque Advocacia</p>
                        </div>
                        <p style="text-align:justify;margin-bottom:12px;">
                            <strong>OUTORGANTE:</strong> ${dados.representa && dados.empresa
                                ? `<strong>${dados.empresa.razao}</strong>, pessoa jur√≠dica de direito privado, inscrita no CNPJ sob o n¬∫ ${dados.empresa.cnpj}, com sede em ${endereco}, neste ato representada por seu <strong>${dados.empresa.representante.cargo}</strong>, <strong>${dados.empresa.representante.nome}</strong>, portador do CPF n¬∫ ${dados.empresa.representante.cpf}.`
                                : dados.representa
                                    ? `<strong>${dados.outorgante.nome}</strong>, ${dados.outorgante.nacionalidade}, ${dados.outorgante.estadoCivil}, ${dados.outorgante.profissao || 'menor'}, portador(a) do RG n¬∫ ${dados.outorgante.rg}, inscrito(a) no CPF sob o n¬∫ ${dados.outorgante.cpf}, residente em ${endereco}, neste ato representado(a) por seu/sua <strong>${dados.representante.qualificacao}</strong>, <strong>${dados.representante.nome}</strong>, portador(a) do CPF n¬∫ ${dados.representante.cpf}.`
                                    : `<strong>${dados.outorgante.nome}</strong>, ${dados.outorgante.nacionalidade}, ${dados.outorgante.estadoCivil}, ${dados.outorgante.profissao}, portador(a) do RG n¬∫ ${dados.outorgante.rg}, inscrito(a) no CPF sob o n¬∫ ${dados.outorgante.cpf}, residente em ${endereco}.`
                            }
                        </p>
                        <p style="margin-bottom:8px;"><strong>OUTORGADOS:</strong></p>
                        <p style="margin:3px 0;">1. <strong>JO√ÉO PAULO SILVA DE MEDEIROS</strong>, advogado, OAB/RN n¬∫ 15.441;</p>
                        <p style="margin:3px 0 12px;">2. <strong>ALANE MEDEIROS DE ALBUQUERQUE</strong>, advogada, OAB/RN n¬∫ 14.994.</p>
                        <p style="text-align:justify;">
                            Pelo presente instrumento particular de procura√ß√£o, o(a) outorgante nomeia e constitui os outorgados como seus bastantes procuradores, conferindo-lhes amplos poderes para o foro em geral, com a cl√°usula <strong>"ad judicia et extra"</strong>, podendo propor a√ß√µes, defend√™-las, transigir, desistir, firmar compromissos, receber e dar quita√ß√£o, levantar FGTS e alvar√°s, substabelecer e praticar todos os atos necess√°rios.
                        </p>
                        <p style="text-align:right;margin-top:20px;">${dados.representa && dados.empresa ? dados.empresa.endereco.cidade + '/' + dados.empresa.endereco.uf : dados.endereco.cidade + '/' + dados.endereco.uf}, ${data}.</p>
                        ${assinatura}
                    </div>
                `,
                hipossuficiencia: `
                    <div style="font-family:'Times New Roman',serif;font-size:11pt;line-height:1.5;padding:20mm 20mm;">
                        <div style="text-align:center;margin-bottom:15px;border-bottom:2px solid #1e3a5f;padding-bottom:10px;">
                            <h3 style="color:#1e3a5f;margin:0;">DECLARA√á√ÉO DE HIPOSSUFICI√äNCIA</h3>
                            <p style="font-size:9pt;color:#666;margin:5px 0 0;">(Art. 99 e seguintes do CPC)</p>
                        </div>
                        <p style="text-align:justify;margin-bottom:12px;">
                            ${dados.representa && dados.empresa
                                ? `Eu, <strong>${dados.empresa.representante.nome}</strong>, ${dados.empresa.representante.cargo} da empresa <strong>${dados.empresa.razao}</strong>, inscrita no CNPJ n¬∫ ${dados.empresa.cnpj},`
                                : dados.representa
                                    ? `Eu, <strong>${dados.representante.nome}</strong>, ${dados.representante.qualificacao} de <strong>${dados.outorgante.nome}</strong>,`
                                    : `Eu, <strong>${dados.outorgante.nome}</strong>, ${dados.outorgante.nacionalidade}, ${dados.outorgante.estadoCivil}, ${dados.outorgante.profissao}, portador(a) do RG n¬∫ ${dados.outorgante.rg} e CPF n¬∫ ${dados.outorgante.cpf}, residente em ${endereco},`
                            }
                        </p>
                        <p style="text-align:center;font-weight:bold;margin:15px 0;">DECLARO</p>
                        <p style="text-align:justify;margin-bottom:12px;">
                            Que ${dados.representa && dados.empresa ? 'a empresa √©' : dados.representa ? 'o(a) representado(a) √©' : 'sou'} hipossuficiente financeiramente, nos termos do art. 99 do C√≥digo de Processo Civil.
                        </p>
                        <p style="margin-bottom:8px;"><strong>Informa√ß√µes financeiras:</strong></p>
                        <ul style="margin:8px 0 12px;padding-left:30px;">
                            <li>Renda mensal bruta: ${renda}</li>
                            <li>N√∫mero de dependentes: ${dependentes}</li>
                            ${processoHipo ? `<li>Processo: ${processoHipo}</li>` : ''}
                        </ul>
                        <p style="text-align:justify;margin-bottom:12px;">
                            <strong>Justificativa:</strong> ${descricao}
                        </p>
                        <p style="text-align:right;">${dados.representa && dados.empresa ? dados.empresa.endereco.cidade + '/' + dados.empresa.endereco.uf : dados.endereco.cidade + '/' + dados.endereco.uf}, ${data}.</p>
                        ${assinatura}
                    </div>
                `,
                contrato: `
                    <div style="font-family:'Times New Roman',serif;font-size:11pt;line-height:1.5;padding:20mm 20mm;page-break-after:auto;">
                        <div style="text-align:center;margin-bottom:15px;border-bottom:2px solid #1e3a5f;padding-bottom:10px;">
                            <h3 style="color:#1e3a5f;margin:0;">CONTRATO DE HONOR√ÅRIOS ADVOCAT√çCIOS</h3>
                            <p style="font-size:9pt;color:#666;margin:5px 0 0;">Medeiros e Albuquerque Advocacia</p>
                        </div>
                        <p style="text-align:justify;margin-bottom:12px;">
                            <strong>CONTRATANTE:</strong> ${dados.representa && dados.empresa
                                ? `<strong>${dados.empresa.razao}</strong>, pessoa jur√≠dica inscrita no CNPJ n¬∫ ${dados.empresa.cnpj}, com sede em ${endereco}, neste ato representada por seu <strong>${dados.empresa.representante.cargo}</strong>, <strong>${dados.empresa.representante.nome}</strong>.`
                                : dados.representa
                                    ? `<strong>${dados.outorgante.nome}</strong>, ${dados.outorgante.nacionalidade}, ${dados.outorgante.estadoCivil}, ${dados.outorgante.profissao || 'menor'}, portador(a) do RG n¬∫ ${dados.outorgante.rg} e CPF n¬∫ ${dados.outorgante.cpf}, residente em ${endereco}, neste ato representado(a) por seu/sua <strong>${dados.representante.qualificacao}</strong>, <strong>${dados.representante.nome}</strong>.`
                                    : `<strong>${dados.outorgante.nome}</strong>, ${dados.outorgante.nacionalidade}, ${dados.outorgante.estadoCivil}, ${dados.outorgante.profissao}, portador(a) do RG n¬∫ ${dados.outorgante.rg} e CPF n¬∫ ${dados.outorgante.cpf}, residente em ${endereco}.`
                            }
                        </p>
                        <p style="text-align:justify;margin-bottom:12px;">
                            <strong>CONTRATADO:</strong> <strong>JO√ÉO PAULO SILVA DE MEDEIROS</strong>, advogado, OAB/RN n¬∫ 15.441.
                        </p>
                        <h4 style="text-align:center;margin:15px 0 8px;text-transform:uppercase;font-size:11pt;">Do Objeto</h4>
                        <p style="text-align:justify;margin-bottom:12px;">
                            <strong>Cl√°usula 1¬™.</strong> √â objeto do presente contrato a presta√ß√£o de servi√ßos advocat√≠cios no processo: <strong>${dados.contrato?.processo || ''}</strong>${dados.contrato?.vara ? ', perante a ' + dados.contrato.vara : ''}.
                        </p>
                        ${gerarClausulaPagamento()}
                        <h4 style="text-align:center;margin:15px 0 8px;text-transform:uppercase;font-size:11pt;">Do Foro</h4>
                        <p style="text-align:justify;margin-bottom:20px;">
                            <strong>Cl√°usula 3¬™.</strong> Para dirimir quaisquer d√∫vidas ou controv√©rsias decorrentes do presente contrato, as partes elegem o foro da Comarca de Natal/RN.
                        </p>
                        <p style="text-align:right;margin-bottom:10px;">Natal/RN, ${data}.</p>
                        ${assinatura}
                    </div>
                `
            };
            return templates[tipo] || templates.procuracao;
        }

        function mostrarResultado() {
            document.getElementById('formulario-principal').classList.remove('active');
            document.getElementById('secao-resultado').classList.add('active');
            const labels = {
                procuracao: 'Procura√ß√£o',
                hipossuficiencia: 'Declara√ß√£o de Hipossufici√™ncia',
                contrato: 'Contrato de Honor√°rios'
            };
            document.getElementById('lista-downloads').innerHTML = state.documentos.map(doc => `
                <div style="padding:15px;background:#f0fff4;border-left:4px solid #38a169;margin-bottom:10px;border-radius:4px;">
                    <strong>‚úì ${labels[doc]}</strong> - PDF gerado e baixado
                </div>
            `).join('');
        }

        function voltarSelecao() {
            document.getElementById('formulario-principal').classList.remove('active');
            document.getElementById('secao-resultado').classList.remove('active');
        }

        function novoDocumento() {
            state.documentos = [];
            state.assinaturaData = null;
            state.auditData = null;
            state.tipoRepresentacao = 'incapaz';
            state.formaPagamento = 'vista';
            document.querySelectorAll('.doc-option').forEach(el => el.classList.remove('selected'));
            document.querySelectorAll('.doc-option input').forEach(el => el.checked = false);
            document.getElementById('opt-incapaz').classList.add('active');
            document.getElementById('opt-empresa').classList.remove('active');
            selecionarPagamento('vista');
            document.querySelectorAll('input, textarea, select').forEach(el => {
                if (el.type === 'checkbox') {
                    el.checked = false;
                } else if (el.tagName === 'SELECT') {
                    if (el.id === 'uf' || el.id === 'emp-uf') el.value = 'RN';
                    else if (el.id === 'estado-civil') el.value = 'Solteiro(a)';
                    else if (el.id === 'cont-parcelas') el.value = '1';
                    else el.selectedIndex = 0;
                } else {
                    el.value = '';
                }
            });
            document.getElementById('campos-representacao').classList.remove('active');
            document.getElementById('rep-incapaz-fields').classList.remove('hidden');
            document.getElementById('rep-empresa-fields').classList.add('hidden');
            document.getElementById('nacionalidade').value = 'Brasileiro(a)';
            document.getElementById('hipo-dependentes').value = '0';
            document.getElementById('cont-vencimento').value = '5';
            document.getElementById('titulo-dados-pessoais').textContent = 'Dados Pessoais do Outorgante';
            document.getElementById('secao-resultado').classList.remove('active');
            document.getElementById('formulario-principal').classList.remove('active');
            document.getElementById('selecao-docs').style.display = 'block';
            mostrarToast('Novo documento iniciado!', 'success');
        }

        function mostrarToast(msg, tipo = 'info') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${tipo}`;
            toast.textContent = msg;
            container.appendChild(toast);
            setTimeout(() => toast.remove(), 4000);
        }
    </script>
</body>
</html>
